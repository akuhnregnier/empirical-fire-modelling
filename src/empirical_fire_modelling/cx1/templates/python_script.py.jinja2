import os
import sys
from pathlib import Path

import cloudpickle
from wildfires.logging_config import enable_logging
from wildfires.qstat import get_ncpus

if "TQDMAUTO" in os.environ:
    from tqdm.auto import tqdm
else:
    from tqdm import tqdm

{%- if pythonpath is defined %}
sys.path = {{pythonpath}}
{%- endif %}

enable_logging(level="DEBUG")

index = int(os.environ.get("PBS_ARRAY_INDEX", 0))

with Path("{{bound_functions_file}}").open("rb") as f:
    bound_functions = cloudpickle.load(f)

# Run the function specified by the index.
bound_functions[index]()
